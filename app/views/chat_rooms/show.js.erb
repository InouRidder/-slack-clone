if (App.active_room_id !== undefined ) {
  App.cable.subscriptions.remove(App[`chat_room_${App.active_room_id}`])
}

App['chat_room_<%= @chat_room.id %>'] = App.cable.subscriptions.create({
    channel: 'ChatRoomsChannel', chat_room_id: <%= @chat_room.id %>
  },
  {
    received: (data) => {
      if (data.current_user_id !== <%= current_user.id %>) {
        const messages = document.querySelector('.messages')
        console.log(data)
        messages.insertAdjacentHTML("beforeend", data.message_partial)
        messages.children[messages.children.length -1].scrollIntoView();
      }
    },
    connected: (data) => {
      console.log('so connected')
      App.active_room_id = <%= @chat_room.id %>;
    }
  }
)

<% if @after_create %>
  Chat.appendChat("<%= j render 'chat_room_links', chat_room: @chat_room %>")
<% end %>
Chat.setChatRoom("<%= j render 'chat_rooms/chat_room', chat_room: @chat_room, message: @message %>");
Chat.removeModal();
Chat.removeNotifications(<%= @chat_room.id %>);
Chat.scrollToLastMessage();

